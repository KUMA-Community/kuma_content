# Пакет контента для Linux
Правила корреляции, входящие в пакет:
|Название                                                            |Механизм обнаружения                                                                                                                                                                                                                                                                                          |Источник событий                                                                            |Тактика MITRE             |Техника MITRE                                                    |Реализация                                                                                                                 |Change log|Дата последнего изменения|Версия KUMA|
|--------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|--------------------------|-----------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------|----------|-------------------------|-----------|
| P200;Linux;Изменение SSH ключей в файле authorized_keys              | Изменение SSH ключей в файле authorized_keys                                                                                                                                                                                                                                                                           | Unix -> PATH                                                                                    | TA0003 (Persistence)       | T1098.004 (Account Manipulation: SSH Authorized Keys)                                                              | Убедитесть, что в конфиге правил auditd "/etc/audit/rules.d/audit.rules" есть следующая запись "-w /root/.ssh/authorized_keys -p wa -k rootkey" |
| P201;Linux;Обнаружена попытка брутфорса                              | Правило обнаруживает события 5 неудачных попыток авторизации в течение 15 минут                                                                                                                                                                                                                                        | Unix -> USER_AUTH                                                                               | TA0006 (Credential Access) | T1110.001 (Brute Force: Password Guessing)                                                                         | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P202;Linux;Обнаружение множества активностей разведки                | Обнаружение 5 различных процессов разведки для в течение 10 мин.                                                                                                                                                                                                                                                       | Correlated Events -> P203;Linux;бнаружение активностей разведки (subCorr)                       | TA0007 (Discovery)         | T1083 (File and Directory Discovery)                                                                               | Для работы правила требуется включение правила "P203;Linux;бнаружение активностей разведки (subCorr)"                                           |
| P203;Linux;Обнаружение активностей разведки (subCorr)                | Единичная сработка активностей разведки.                                                                                                                                                                                                                                                                               | Unix -> EXECVE                                                                                  | \-                         | \-                                                                                                                 | Для работы правила требуется включение правила "P204;Linux;Обнаружение активностей разведки (operational)"                                      |
| P204;Linux;Обнаружение активностей разведки (operational)            | Правило добавляет в лист пользователя выполневшего команды разведки с ключом id события (DeviceExternalID).                                                                                                                                                                                                            | Unix -> SYSCALL                                                                                 | \-                         | \-                                                                                                                 | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P205;Linux;Очистка журнала Audit Log                                 | Обнаружена очистка логов Linux. Получение пользователя из AL.                                                                                                                                                                                                                                                          | Unix -> EXECVE                                                                                  | TA0005 (Defense Evasion)   | T1070.002 (Indicator Removal: Clear Linux or Mac System Logs)                                                      | Для работы правила требуется включение правила "P206;Linux;Очистка Audit Log (operational)"                                                     |
| P206;Linux;Очистка Audit Log (operational)                           | Правило добавляет в лист пользователя выполневшего команды удаления логов с ключом id события (DeviceExternalID).                                                                                                                                                                                                      | Unix -> SYSCALL                                                                                 | \-                         | \-                                                                                                                 | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P207;Linux;Вызов Hacktool                                            | Правило выявляет запуск процессов, связанных со списком хакерских утилит для ОС Linux. Получение пользователя из AL.                                                                                                                                                                                                   | Unix -> EXECVE                                                                                  | \-                         | \-                                                                                                                 | Для работы правила требуется включение правила "P208;Linux;Вызов Linux Hacktool (operational)"                                                  |
| P208;Linux;Вызов Linux Hacktool (operational)                        | Правило добавляет в лист пользователя выполневшего подозрительные команды (хакерских утилит) с ключом id события (DeviceExternalID).                                                                                                                                                                                   | Unix -> SYSCALL                                                                                 | \-                         | \-                                                                                                                 | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P209;Linux;Обнаружена новая задача в Cron                            | Обнаружена новая задача Cron, ранее не встречавшаяся в организации. Необходимо подавать логи CronD либо настроенный auditD                                                                                                                                                                                             | Unix -> CRON, CROND                                                                             | TA0003 (Persistence)       | T1053.003 (Scheduled Task/Job: Cron)                                                                               | Для работы правила требуется включение правила "P210;Linux;Добавлена Сron задача (operational)" на две недели для обучения.                     |
| P210;Linux;Добавлена Сron задача (operational)                       | Правило добавляет в лист выполняемые команды из планировщика cron c привязкой к хосту.                                                                                                                                                                                                                                 | Unix -> CRON, CROND                                                                             | \-                         | \-                                                                                                                 | Для обучения в течение 2 недель, далее правило необходимо выключить!                                                                            |
| P211;Linux;Обнаружен успешный брутфорс                               | Правило обнаруживает события успешного входа в систему после большого количества неудачных попыток авторизации от 10 в течение 15 мин                                                                                                                                                                                  | Correlated Events -> "P201;Linux;Обнаружена попытка брутфорса"<br>Unix -> USER_LOGIN, USER_AUTH | TA0006 (Credential Access) | T1110 (Brute Force)                                                                                                | Для работы правила требуется включение правила "P201;Linux;Обнаружена попытка брутфорса"                                                        |
| P212;Linux;Старт Сессии (ssh and local) (operational)                | Правило добавляет в лист данные по машине (ключ) и другие данные по открытию сессии.<br>Пример записи - номер_сессии(AUID auid isRoot logonType): 361(dmitry1 1002 not-root local);                                                                                                                                    | Unix -> USER_START                                                                              | \-                         | \-                                                                                                                 | Правила P212-P215 работают совместно и необходимо включение всех правил для сохранения сессий.                                                  |
| P213;Linux;Конец Сессии (ssh and local) (operational)                | Правило удаляет из листа данные по пользователю по закрытию сессии.                                                                                                                                                                                                                                                    | Unix -> USER_END                                                                                | \-                         | \-                                                                                                                 | Правила P212-P215 работают совместно и необходимо включение всех правил для сохранения сессий.                                                  |
| P214;Linux;Старт Сессии (su) (operational)                           | Правило добавляет в лист данные (суперпользователь) по машине (ключ) и другие данные по открытию сессии.<br>Пример записи - номер_сессии(AUID auid isRoot logonType): 361(dmitry1 1002 not-root local);                                                                                                                | Unix -> USER_START                                                                              | \-                         | \-                                                                                                                 | Правила P212-P215 работают совместно и необходимо включение всех правил для сохранения сессий.                                                  |
| P215;Linux;Конец Сессии (su) (operational)                           | Правило удаляет из листа данные (суперпользователь) по закрытию сессии.                                                                                                                                                                                                                                                | Unix -> USER_END                                                                                | \-                         | \-                                                                                                                 | Правила P212-P215 работают совместно и необходимо включение всех правил для сохранения сессий.                                                  |
| P216;Linux;Подозрение на Rootkit                                     | Подозрение на rootkit - обращение к /etc/ld.so.preload<br>key=writed                                                                                                                                                                                                                                                   | Unix -> SYSCALL                                                                                 | TA0005 (Defense Evasion)   | T1014 (Rootkit)                                                                                                    | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P217;Linux;Удаленный вход под учетной записью root                   | Улучшение R003_01_Remote SSH connection with root account on Linux<br><br>Добавлено исключение повторных сработок через ActiveList по составному ключу (DeviceHostName + SourceAddress + SourceUserName). Сработки на удаленный вход регистрируются 1 раз в сутки.<br>Добавлен USER_ACCT добавлен EventOutcome=success | Unix -> USER_AUTH                                                                               | \-                         | \-                                                                                                                 | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P218;Linux;Множественные подключения с хоста по SSH ко многим        | Подключение по SSH с одного хоста на множества хостов.<br>5 разных подключений на DeviceHostName за 10 минут.                                                                                                                                                                                                          | UNIX -> EXECVE, SYSCALL                                                                         | TA0001 (Initial Access)    | T1078 (Valid Accounts)                                                                                             | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P219;Linux;Перезагрузка системы                                      | Правило обнаруживает активных пользователей системы на момент перезагрузки.                                                                                                                                                                                                                                            | Unix -> systemd-logind                                                                          | TA0040 (Impact)            | T1529 (System Shutdown/Reboot)                                                                                     | Для работы правила требуется включение правил P212-P215                                                                                         |
| P260;Linux;Использование утилиты копирования данных из буфера обмена | Обнаружение использования утилиты копирования данных из буфера обмена                                                                                                                                                                                                                                                  | Unix -> EXECVE                                                                                  | TA0009 (Collection)        | T1115 (Clipboard Data)                                                                                             | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P261;Linux;Создание/Добавление пользователя в группу Root/Sudoers    | Обнаружение добавления пользователя в группу Root/Sudoers                                                                                                                                                                                                                                                              | Unix -> EXECVE -> usermod                                                                       | TA0003 (Persistence)       | T1098 (Account Manipulation)                                                                                       | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P262;Linux;Удаление файлов                                           | Обнаруживает удаление файлов с помощью команд rm, shred, rmdir, find -delete или unlink, которые часто используются злоумышленниками для удаления файлов, оставшихся после действий их вторжений.                                                                                                                      | Unix -> EXECVE -> rm, shred, rmdir, find -delete                                                | TA0040 (Impact)            | T1485 (Data Destruction)                                                                                           | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P263;Linux;Запуск процесса из /tmp                                   | Обнаружение перезаписи файла утилитой DD                                                                                                                                                                                                                                                                               | Unix -> EXECVE -> /tmp                                                                          | TA0002 (Execution)         | T1059 (Command and Scripting Interpreter)                                                                          | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P264;Linux;Остановка процесса с KILL                                 | Обнаружение остановки процесса с KILL                                                                                                                                                                                                                                                                                  | Unix -> EXECVE -> kill                                                                          | TA0005 (Defense Evasion)   | T1562 (Impair Defenses)                                                                                            | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P265;Linux;Изменение Audit правил                                    | Правило обнаруживает изменения в настройках (правилах) демона аудита auditd.                                                                                                                                                                                                                                           | Unix -> CONFIG_CHANGE                                                                           | TA0005 (Defense Evasion)   | T1562.012 (Impair Defenses: Disable or Modify Linux Audit System)                                                  | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P266;Linux;Перечисление CRONTAB                                      | Обнаружение перечисления CRONTAB                                                                                                                                                                                                                                                                                       | Unix -> EXECVE -> crontab                                                                       | TA0007 (Discovery)         | T1007 (System Service Discovery)                                                                                   | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P267;Linux;Поиск средств защиты                                      | Обнаружение поиска средств защиты                                                                                                                                                                                                                                                                                      | Unix -> PATH -> /var/spool/cron/atjobs/                                                         | TA0007 (Discovery)         | T1518.001 (Software Discovery: Security Software Discovery)                                                        | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P268;Linux;Создание отложенной задачи At Job                         | Обнаружение создание отложенной задачи с помощью команды At                                                                                                                                                                                                                                                            | Unix -> PATH-> CRATE -> atjobs                                                                  | TA0003 (Persistence)       | T1053.002 (Scheduled Task/Job: At)                                                                                 | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P269;Linux;Возможные команды Reverse Shell                           | Обнаружение подозрительных команд по созданию Reverse Shell                                                                                                                                                                                                                                                            | Unix -> PROCTITLE, EXECVE -> regex                                                              | TA0002 (Execution)         | T1059.004 (Command and Scripting Interpreter: Unix Shell)                                                          | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P270;Linux;Добавление специальных привелегий к файлу                 | Обнаружено добавление специальных привелегий к файлу setcap, chmod                                                                                                                                                                                                                                                     | Unix -> EXECVE -> setcap                                                                        | TA0003 (Persistence)       | T1548 (Abuse Elevation Control Mechanism)                                                                          | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P271;Linux;Изменение файла /etc/passwd                               | Обнаружение изменения файла/etc/passwd, возможно добавление пользователя                                                                                                                                                                                                                                               | Unix -> PATH -> /etc/passwd                                                                     | TA0003 (Persistence)       | T1556.003 (Modify Authentication Process: Pluggable Authentication Modules)                                        | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P272;Linux;Изменение пароля пользователя                             | Обнаружение изменение пароля пользователя                                                                                                                                                                                                                                                                              | Unix -> PAM -> password changed                                                                 | TA0003 (Persistence)       | T1098 (Account Manipulation)                                                                                       | Для работы правила не требуется дополнительных настроек.                                                                                        |
| P273;Linux;Добавление прав исполнения                                | Обнаружено добавление прав исполнения к файлу или папке chmod                                                                                                                                                                                                                                                          | Unix -> EXECVE -> chmod                                                                         | TA0005 (Defense Evasion)   | T1222.002 (File and Directory Permissions Modification: Linux and Mac File and Directory Permissions Modification) | Для работы правила не требуется дополнительных настроек.                                                                                        |
